digraph lpegNode {

node [fontname=Helvetica]
edge [style=dashed]

doc_0 [label="doc - 150"]


doc_0 -> { section_1}
{rank=same; section_1}

section_1 [label="section: 1-71"]


// END RANK doc_0

section_1 -> { header_2 prose_3 prose_4 prose_5 codeblock_6 section_7}
{rank=same; header_2 prose_3 prose_4 prose_5 codeblock_6 section_7}

header_2 [label="1 : A Grammar For Lua"]

prose_3 [label="prose"]

prose_4 [label="prose"]

prose_5 [label="prose"]

codeblock_6 [label="code block 12-69"]

section_7 [label="section: 72-87"]


// END RANK section_1

header_2 -> leaf_8
leaf_8  [color=Gray,shape=rectangle,fontname=Inconsolata,label="* A Grammar For Lua"]
// END RANK header_2

prose_3 -> { raw_9}
{rank=same; raw_9}

raw_9 [label="raw"]


// END RANK prose_3

raw_9 -> leaf_10
leaf_10  [color=Gray,shape=rectangle,fontname=Inconsolata,label="

While the most important grammar for pegylator is pegylator itself, it's
time to make a Lua language parser.
"]
// END RANK raw_9

prose_4 -> { raw_11}
{rank=same; raw_11}

raw_11 [label="raw"]


// END RANK prose_4

raw_11 -> leaf_12
leaf_12  [color=Gray,shape=rectangle,fontname=Inconsolata,label="
The hard work is done on this, it's a matter of translation into the
Pegylator paradigm.
"]
// END RANK raw_11

prose_5 -> { raw_13}
{rank=same; raw_13}

raw_13 [label="raw"]


// END RANK prose_5

raw_13 -> leaf_14
leaf_14  [color=Gray,shape=rectangle,fontname=Inconsolata,label="
While this a hell of a lot of work, the complete BNF of Lua is available,
and reproduced here.
"]
// END RANK raw_13

codeblock_6 -> leaf_15
leaf_15  [color=Gray,shape=rectangle,fontname=Inconsolata,label="chunk ::= {stat [`;´]} [laststat [`;´]]

   block ::= chunk

   stat ::=  varlist `=´ explist |
       functioncall |
       do block end |
       while exp do block end |
       repeat block until exp |
       if exp then block {elseif exp then block} [else block] end |
       for Name `=´ exp `,´ exp [`,´ exp] do block end |
       for namelist in explist do block end |
       function funcname funcbody |
       local function Name funcbody |
       local namelist [`=´ explist]

   laststat ::= return [explist] | break

   funcname ::= Name {`.´ Name} [`:´ Name]

   varlist ::= var {`,´ var}

   var ::=  Name | prefixexp `[´ exp `]´ | prefixexp `.´ Name

   namelist ::= Name {`,´ Name}

   explist ::= {exp `,´} exp

   exp ::=  nil | false | true | Number | String | `...´ | function |
       prefixexp | tableconstructor | exp binop exp | unop exp

   prefixexp ::= var | functioncall | `(´ exp `)´

   functioncall ::=  prefixexp args | prefixexp `:´ Name args

   args ::=  `(´ [explist] `)´ | tableconstructor | String

   function ::= function funcbody

   funcbody ::= `(´ [parlist] `)´ block end

   parlist ::= namelist [`,´ `...´] | `...´

   tableconstructor ::= `{´ [fieldlist] `}´

   fieldlist ::= field {fieldsep field} [fieldsep]

   field ::= `[´ exp `]´ `=´ exp | Name `=´ exp | exp

   fieldsep ::= `,´ | `;´

   binop ::= `+´ | `-´ | `*´ | `/´ | `^´ | `%´ | `..´ |
       `<´ | `<=´ | `>´ | `>=´ | `==´ | `~=´ |
       and | or

   unop ::= `-´ | not | `#´"]
// END RANK codeblock_6

section_7 -> { header_16 prose_17 section_18 section_19}
{rank=same; header_16 prose_17 section_18 section_19}

header_16 [label="2 : Implementation"]

prose_17 [label="prose"]

section_18 [label="section: 77-87"]

section_19 [label="section: 88-150"]


// END RANK section_7

header_16 -> leaf_20
leaf_20  [color=Gray,shape=rectangle,fontname=Inconsolata,label="** Implementation"]
// END RANK header_16

prose_17 -> { raw_21}
{rank=same; raw_21}

raw_21 [label="raw"]


// END RANK prose_17

raw_21 -> leaf_22
leaf_22  [color=Gray,shape=rectangle,fontname=Inconsolata,label="

Let's try it.

"]
// END RANK raw_21

section_18 -> { header_23 prose_24 codeblock_25}
{rank=same; header_23 prose_24 codeblock_25}

header_23 [label="3 : Imports"]

prose_24 [label="prose"]

codeblock_25 [label="code block 79-85"]


// END RANK section_18

header_23 -> leaf_26
leaf_26  [color=Gray,shape=rectangle,fontname=Inconsolata,label="*** Imports"]
// END RANK header_23

prose_24 -> { raw_27}
{rank=same; raw_27}

raw_27 [label="raw"]


// END RANK prose_24

raw_27 -> leaf_28
leaf_28  [color=Gray,shape=rectangle,fontname=Inconsolata,label="
"]
// END RANK raw_27

codeblock_25 -> leaf_29
leaf_29  [color=Gray,shape=rectangle,fontname=Inconsolata,label="local Node    =  require \"espalier/node\"
local Grammar =  require \"espalier/grammar\"
local L       =  require \"espalier/elpatt\"

local P, R, E, V, S    =  L.P, L.R, L.E, L.V, L.S"]
// END RANK codeblock_25

section_19 -> { header_30 prose_31 prose_32 prose_33 prose_34 codeblock_35}
{rank=same; header_30 prose_31 prose_32 prose_33 prose_34 codeblock_35}

header_30 [label="3 : lua_fn"]

prose_31 [label="prose"]

prose_32 [label="prose"]

prose_33 [label="prose"]

prose_34 [label="prose"]

codeblock_35 [label="code block 98-132"]


// END RANK section_19

header_30 -> leaf_36
leaf_36  [color=Gray,shape=rectangle,fontname=Inconsolata,label="*** lua_fn"]
// END RANK header_30

prose_31 -> { raw_37}
{rank=same; raw_37}

raw_37 [label="raw"]


// END RANK prose_31

raw_37 -> leaf_38
leaf_38  [color=Gray,shape=rectangle,fontname=Inconsolata,label="

This is provided to the Grammar engine to create a Lua parser.
"]
// END RANK raw_37

prose_32 -> { raw_39}
{rank=same; raw_39}

raw_39 [label="raw"]


// END RANK prose_32

raw_39 -> leaf_40
leaf_40  [color=Gray,shape=rectangle,fontname=Inconsolata,label="
- #Todo this being a 5.1 grammar, need to add goto statements.
"]
// END RANK raw_39

prose_33 -> { raw_41}
{rank=same; raw_41}

raw_41 [label="raw"]


// END RANK prose_33

raw_41 -> leaf_42
leaf_42  [color=Gray,shape=rectangle,fontname=Inconsolata,label="
- #Todo add the whitespace
"]
// END RANK raw_41

prose_34 -> { raw_43 prespace_44 literal_45 raw_46}
{rank=same; raw_43 prespace_44 literal_45 raw_46}

raw_43 [label="raw"]

prespace_44 [label="prespace"]

literal_45 [label="literal"]

raw_46 [label="raw"]


// END RANK prose_34

raw_43 -> leaf_47
leaf_47  [color=Gray,shape=rectangle,fontname=Inconsolata,label="
- #Todo add precedence parsing of"]
// END RANK raw_43

prespace_44 -> leaf_48
leaf_48  [color=Gray,shape=rectangle,fontname=Inconsolata,label=" "]
// END RANK prespace_44

literal_45 -> leaf_49
leaf_49  [color=Gray,shape=rectangle,fontname=Inconsolata,label="exp"]
// END RANK literal_45

raw_46 -> leaf_50
leaf_50  [color=Gray,shape=rectangle,fontname=Inconsolata,label="
"]
// END RANK raw_46

codeblock_35 -> leaf_51
leaf_51  [color=Gray,shape=rectangle,fontname=Inconsolata,label="local _do, _end, _then = P\"do\", P\"end\", P\"then\"

local function lua_fn(ENV)
   START \"lua\"
   lua   = V\"chunk\"^1
   chunk = (V\"stat\" * P\";\"^0) * (V\"laststat\"^0 * P\";\"^0)^-1
   block = V\"chunk\"

   stat  = V\"varlist\" * P\"=\" * V\"explist\" +
           V\"functioncall\" +
           _do * V\"block\" * _end +
           P\"while\" * V\"exp\" * _do * V\"block\" * _end +
           P\"repeat\" * V\"block\" * P\"until\" * _end +
           P\"if\" * V\"exp\" * _then * V\"block\" *
              ( P\"elseif\" V\"exp\" * _then * V\"block\" )^0 *
              ( P\"else\" * V\"block\" )^-1 * _end +
           P\"for\" * V\"Name\" * P\"=\" * V\"exp\" * P\",\" * V\"exp\" *
              ( P\",\" * V\"exp\" )^-1 * _do * V\"block\" * _end +
           P\"for\" * V\"namelist\" * P\"in\" * V\"explist\" * _do *
              V\"block\" * _end +
           P\"function\" * V\"funcname\" * V\"funcbody\" +
           P\"local\" * P\"function\" * V\"Name\" * V\"funcbody\" +
           P\"local\" * V\"namelist\" * ( P\"=\" * V\"explist\" )^-1

   laststat = P\"return\" * V\"explist\"^-1 + P\"break\"

   funcname = V\"Name\" * ( P\".\" * V\"Name\" )^0 * ( P\":\" V\"Name\" )

   varlist  = V\"var\" * ( P\",\" V\"var\")^0

   var      = V\"Name\" + V\"prefixexp\" * P\"[\" * V\"exp\" * P\"]\" +
                 V\"prefixexp\" * \".\" * V\"Name\"
end"]
// END RANK codeblock_35


}
